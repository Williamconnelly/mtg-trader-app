<mat-drawer-container class="example-container">
  <!-- Main Content -->
  <mat-drawer-content>
    <button mat-raised-button (click)="drawer.toggle()">Toggle drawer</button>
    <h1 *ngIf="tradeState.completed">Trade completed!</h1>
    <app-trade-display *ngIf="trade && trade.hasOwnProperty('collections')" #userDisplay [userCards]="userOffers" [role]="loggedUser.role" (targetCardEmitter)="targetCardFromOffer($event)"></app-trade-display>
    <app-trade-display *ngIf="trade && trade.hasOwnProperty('collections')" #partnerDisplay [userCards]="partnerOffers" [role]="partner.role"></app-trade-display>
    <app-trade-message *ngIf="trade && trade.hasOwnProperty('messages')"
    [socket]="socket"
    [tradeId]="tradeId"
    [loggedUser]="loggedUser"
    [partner]="partner"
    [messages]="trade.messages"
    ></app-trade-message>
  </mat-drawer-content>
  <!-- Drawer Content -->
  <mat-drawer #drawer mode="side">
    <!-- TODO: REFINE RENDERING ON LOCKED STATE FOR SCROLL-BOX AND CURRENT-CARD -->
    <div class="scroll-box" *ngIf="trade !== undefined && trade.hasOwnProperty('collections') && !tradeState.locked">
      <div *ngFor="let card of collection" class="card-row" (click)=targetCard(card) [class.matched]="card.hasOwnProperty('match')">
        <p class="row-name">{{ card.printing.card.name }} <span *ngIf="card.foil === true">(f)</span></p>
        <p class="row-set">{{ card.printing.set.title }}<span class="row-num">Available: {{ card.trade_copies }}</span></p>
      </div>
    </div>
    <div *ngIf="currentCard.selection && currentCard.selection.hasOwnProperty('id') && !tradeState.locked" class="current-card">
      <img class="target-img" src="{{currentCard.selection.printing.img_url}}" alt="{{currentCard.selection.printing.card.name}}">
      <div *ngIf ="updateBool === false">
        <select [(ngModel)]="currentCard.offerNumber" name="offerSelect">
          <option *ngFor="let i of currentCard.offerArray" [ngValue]="i">{{ i }}</option>
        </select>
        <button (click)="addCard()" class="add-button">Add to Trade</button>
      </div>
      <div *ngIf ="updateBool === true">
        <select [(ngModel)]="currentCard.offerNumber" name="offerSelect">
          <option *ngFor="let i of currentCard.offerArray" [ngValue]="i">{{ i }}</option>
        </select>
      <button (click)="updateCard()" class="add-button">Update Offer</button>
      <button (click)="removeCard()">Remove</button>
      </div>
    </div>
    <div *ngIf="loggedUser['role'] === 'user_a'">
      <button *ngIf="!trade.a_lock" (click)="progressTrade(loggedUser['role'], 'lock')">Lock Trade</button>
      <button *ngIf="trade.a_lock" (click)="progressTrade(loggedUser['role'], 'unlock')">Unlock</button>
      <button *ngIf="trade.a_lock && trade.b_lock" (click)="progressTrade(loggedUser['role'], 'submit')">Submit Trade</button>
    </div>
    <div *ngIf="loggedUser['role'] === 'user_b'">
      <button *ngIf="!trade.b_lock" (click)="progressTrade(loggedUser['role'], 'lock')">Lock Trade</button>
      <button *ngIf="trade.b_lock" (click)="progressTrade(loggedUser['role'], 'unlock')">Unlock</button>
      <button *ngIf="trade.a_lock && trade.b_lock" (click)="progressTrade(loggedUser['role'], 'submit')">Submit Trade</button>
    </div>
  </mat-drawer>
</mat-drawer-container>
